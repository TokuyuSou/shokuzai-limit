<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>食材リミット</title>
  <link rel="stylesheet" href="./assets/styles.css" />
  <!-- OCR & LLM (global) -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/web-llm@latest/dist/web-llm.min.js"></script>
</head>
<body>
  <header class="header">
    <div class="wrap">
      <h1>🍳 食材リミット <span class="badge">MVP+</span></h1>
    </div>
  </header>

  <main class="wrap grid">
    <!-- 左：在庫 + スキャン -->
    <section class="card">
      <h2>在庫 & 追加</h2>
      <div class="section">
        <form id="addForm">
          <div class="field"><label>食材名</label><input id="name" placeholder="例: にんじん" required></div>
          <div class="field"><label>数量</label><input id="qty" type="number" min="0" step="0.1" value="1" required></div>
          <div class="field"><label>単位</label>
            <select id="unit"><option>個</option><option>g</option><option>ml</option><option>束</option></select>
          </div>
          <div class="field"><label>賞味(消費)期限</label><input id="expiry" type="date"></div>
          <div class="field"><label>カテゴリ</label>
            <select id="category"><option>野菜</option><option>肉・魚</option><option>乳製品</option><option>穀物</option><option>調味料</option><option>その他</option></select>
          </div>
          <div class="stack">
            <button class="btn" type="submit">在庫に追加</button>
            <button class="btn secondary" type="button" id="quickExp">+3日で設定</button>
            <button class="btn ghost" type="button" id="clearForm">クリア</button>
          </div>
        </form>
      </div>

      <div class="section">
        <h3 class="h3">カメラスキャン（期限OCR）</h3>
        <div class="camera">
          <video id="video" playsinline muted></video>
          <div class="stack">
            <button class="btn" id="startCam">カメラ開始</button>
            <button class="btn secondary" id="snap">撮影→OCR</button>
            <span class="pill">対応例: 2025/08/21, 25-08-21, 2025.08.21</span>
          </div>
          <canvas id="canvas" hidden></canvas>
          <div id="ocrOut" class="muted"></div>
        </div>
      </div>

      <div class="section">
        <h3 class="h3">在庫一覧 <span id="invCount" class="muted"></span></h3>
        <div class="table-head muted">
          <div>#</div><div>食材</div><div>数量</div><div>期限</div><div>残り日数</div><div>カテゴリ</div><div></div>
        </div>
        <div id="inventory"></div>
        <div class="stack" style="margin-top:10px">
          <button class="btn ghost" id="exportJson">在庫をJSONで保存</button>
          <input type="file" id="importJson" accept="application/json" style="display:none"/>
          <button class="btn ghost" id="importBtn">JSONから読み込み</button>
          <button class="btn warn right" id="wipe">全削除</button>
        </div>
      </div>
    </section>

    <!-- 右：レシピ + AI + 買い物 -->
    <section class="card">
      <h2>レシピ提案 & 音声ガイド</h2>
      <div class="section">
        <div class="stack" style="align-items:center">
          <label class="muted">優先: <span class="kbd">期限が近い</span> / 制限: <span class="kbd">~30分</span> / 難易度: <span class="kbd">かんたん</span></label>
          <button class="btn" id="gen">レシピを生成</button>
          <button class="btn secondary" id="genAI" title="オンデバイスLLMで生成（無料）">AIレシピ（無料）</button>
          <span id="aiStatus" class="muted"></span>
        </div>
      </div>
      <div class="section" id="recipeArea">
        <div class="muted">まだレシピがありません。左の在庫を追加して「レシピを生成」を押してください。</div>
      </div>
      <div class="section">
        <h3 class="h3">買い物リスト</h3>
        <ul id="shopping"></ul>
        <div class="stack">
          <button class="btn ghost" id="copyShop">コピー</button>
          <button class="btn ghost" id="clearShop">クリア</button>
        </div>
      </div>
      <div class="section">
        <details>
          <summary class="muted">プレミアム機能（ダミー）</summary>
          <p>栄養バランス分析と健康管理はプレミアム（¥500/月）で提供予定です。</p>
        </details>
      </div>
    </section>
  </main>

  <div class="footer">MVP+: ローカル保存 / OCR / 無料AI（WebGPU）。音声はWeb Speech APIを使用。</div>

  <!-- アプリ本体（ES Modules） -->
  <script type="module" src="./js/main.js"></script>
</body>
</html>
